{% extends 'base.html' %} {# Assuming a base.html exists for common layout #}

{% block content %}
<div class="container mt-4">
    <h2>Activity Logs</h2>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Object Type</th>
                <th>Object</th>
                <th>User</th>
                <th>Action</th>
                <th>Details</th>
                <th>Timestamp</th>
            </tr>
        </thead>
        <tbody>
            {% for log in logs %}
            <tr>
                <td>
                    {% if log.object_type == 'actividad' %}
                        <span class="badge bg-primary">Activity</span>
                    {% elif log.object_type == 'tipo_actividad' %}
                        <span class="badge bg-secondary">Activity Type</span>
                    {% elif log.object_type == 'coordinador' %}
                        <span class="badge bg-warning text-dark">Coordinator</span>
                    {% else %}
                        <span class="badge bg-light text-dark">{{ log.object_type|title }}</span>
                    {% endif %}
                </td>
                <td>{{ log.object_name }}</td>
                <td>{{ log.usuario.username }}</td>
                <td>
                    {% if log.tipo_log == 'Creaci贸n' or log.tipo_log == 'Asignaci贸n' %}
                        <span class="badge bg-success">{{ log.tipo_log }}</span>
                    {% elif log.tipo_log == 'Modificaci贸n' %}
                        <span class="badge bg-info text-dark">{{ log.tipo_log }}</span>
                    {% elif log.tipo_log == 'Eliminaci贸n' %}
                        <span class="badge bg-danger">{{ log.tipo_log }}</span>
                    {% else %}
                        <span class="badge bg-secondary">{{ log.tipo_log }}</span>
                    {% endif %}
                </td>
                <td>
                    {% if log.details %}
                        {{ log.details|truncatechars:100 }}
                    {% elif log.actividad %}
                        <!-- Backward compatibility for old logs -->
                        Activity: {{ log.actividad.nombre }}
                        {% if log.actividad.asignaturas.exists %}
                            <br><small class="text-muted">
                                Subjects: {% for asignatura in log.actividad.asignaturas.all %}{{ asignatura.nombre }}{% if not forloop.last %}, {% endif %}{% endfor %}
                            </small>
                        {% endif %}
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td>{{ log.timestamp|date:"M d, Y H:i" }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6" class="text-center text-muted">No activity logs found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <div class="mt-3">
        <a href="{% url 'admin_dashboard' %}" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Back to Dashboard
        </a>
    </div>
</div>
{% endblock %}